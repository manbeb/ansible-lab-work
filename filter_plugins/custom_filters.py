#!/usr/bin/python3
# -*- coding: utf-8 -*-

# Импортируем модуль для работы с регулярными выражениями
import re

def to_slug(value):
    """
    Преобразует строку в 'slug'.
    Пример: "Some String!" -> "some-string"
    """
    # 1. Приводим к строке и нижнему регистру
    s = str(value).lower()
    
    # 2. Удаляем все символы, которые не являются буквами, цифрами,
    # пробелами или дефисами.
    s = re.sub(r'[^\w\s-]', '', s)
    
    # 3. Заменяем один или несколько пробелов на один дефис
    # и убираем лишние дефисы по краям.
    s = re.sub(r'[\s]+', '-', s).strip('-')
    
    return s

# --- Это обязательная часть для любого плагина-фильтра Ansible ---
class FilterModule(object):
    """
    Класс, который Ansible ищет для регистрации фильтров.
    """
    def filters(self):
        """
        Этот метод должен возвращать словарь, где:
        - ключ: имя фильтра, как мы будем его вызывать в Jinja2 (например, {{ my_var | to_slug }})
        - значение: имя функции Python, которая реализует фильтр
        """
        return {
            'to_slug': to_slug
        }
